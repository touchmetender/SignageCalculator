<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Signage Material Manager</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .tabs { display: flex; gap: 10px; margin-bottom: 10px; }
    .tabs button { padding: 10px; cursor: pointer; }
    .hidden { display: none; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    input { width: 100%; border: none; background: transparent; }
    input:focus { outline: 1px solid #aaa; }
    .add-row { margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Signage Material Manager</h2>
  <div class="tabs" id="tabs"></div>
  <div id="sheets"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getDatabase, ref, get, set, update } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

    const firebaseConfig = {
  apiKey: "AIzaSyCXtiSnNBHs1NQXwL6vrK-U71veeMpIpXQ",
  authDomain: "signagematerialdatabaseapp.firebaseapp.com",
  projectId: "signagematerialdatabaseapp",
  storageBucket: "signagematerialdatabaseapp.firebasestorage.app",
  messagingSenderId: "276886100857",
  appId: "1:276886100857:web:ec1b93f74995aa30e1ada8",
  measurementId: "G-R4EHYT0MW6"
};

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const categories = ["General", "Light", "Metal", "Paint", "Plastic", "Vinyl"];
    const tabs = document.getElementById("tabs");
    const sheets = document.getElementById("sheets");

    let activeSheet = null;

    function createTable(category, materials) {
      const container = document.createElement("div");
      container.id = category;
      container.className = "sheet hidden";

      const table = document.createElement("table");
      const thead = table.createTHead();
      const headers = ["Material Code", "Material Name", "Material Price", "Unit", "Price per Unit", "Unit 2"];
      const headRow = thead.insertRow();
      headers.forEach(h => {
        const th = document.createElement("th");
        th.innerText = h;
        headRow.appendChild(th);
      });

      const tbody = table.createTBody();

      Object.entries(materials || {}).forEach(([id, row]) => {
        const tr = tbody.insertRow();
        headers.forEach((key, i) => {
          const td = tr.insertCell();
          const input = document.createElement("input");
          input.value = row[key.toLowerCase().replace(/\s+/g, '_')] || "";
          input.addEventListener("change", () => {
            update(ref(db, `materials/${category}/${id}`), {
              [key.toLowerCase().replace(/\s+/g, '_')]: input.value
            });
          });
          td.appendChild(input);
        });
      });

      // Add new row
      const addRowBtn = document.createElement("button");
      addRowBtn.className = "add-row";
      addRowBtn.innerText = "âž• Add New Material";
      addRowBtn.onclick = () => {
        const newKey = Date.now();
        const newData = {
          material_code: "",
          material_name: "",
          material_price: "",
          unit: "",
          price_per_unit: "",
          unit2: ""
        };
        set(ref(db, `materials/${category}/${newKey}`), newData).then(() => {
          createUI(); // Reload
        });
      };

      container.appendChild(table);
      container.appendChild(addRowBtn);
      return container;
    }

    function createUI() {
      tabs.innerHTML = "";
      sheets.innerHTML = "";

      categories.forEach(category => {
        const btn = document.createElement("button");
        btn.innerText = category;
        btn.onclick = () => {
          document.querySelectorAll(".sheet").forEach(s => s.classList.add("hidden"));
          document.getElementById(category).classList.remove("hidden");
          activeSheet = category;
        };
        tabs.appendChild(btn);
      });

      Promise.all(categories.map(category =>
        get(ref(db, `materials/${category}`)).then(snapshot => [category, snapshot.val()])
      )).then(results => {
        results.forEach(([category, data]) => {
          const sheet = createTable(category, data);
          sheets.appendChild(sheet);
        });
        document.getElementById(categories[0]).classList.remove("hidden");
      });
    }

    createUI();
  </script>
</body>
</html>
