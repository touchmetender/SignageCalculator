<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Signage Calculator - Materials</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f2f2f2; }
    .top-bar { display: flex; justify-content: space-between; margin-bottom: 20px; }
    button { padding: 5px 10px; }
    table { width: 100%; background: white; border-collapse: collapse; }
    th, td { padding: 10px; border: 1px solid #ccc; }
    input, select { padding: 5px; }
  </style>
</head>
<body>
<div class="top-bar">
  <div id="user-info">Logged in as: </div>
  <button onclick="logout()">Logout</button>
</div>

<h2>Material Database</h2>
<table id="material-table">
  <thead>
    <tr>
      <th>Material Code</th>
      <th>Material Name</th>
      <th>Price</th>
      <th>Unit</th>
      <th>Price per Unit</th>
      <th>Unit</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="material-body"></tbody>
</table>

<h3>Add / Edit Material</h3>
<input type="text" id="code" placeholder="Material Code">
<input type="text" id="name" placeholder="Material Name">
<input type="number" id="price" placeholder="Material Price">
<input type="text" id="unit" placeholder="Unit">
<input type="number" id="priceUnit" placeholder="Price per Unit">
<input type="text" id="unit2" placeholder="Unit Again">
<button onclick="saveMaterial()">Save</button>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCXtiSnNBHs1NQXwL6vrK-U71veeMpIpXQ",
  authDomain: "signagematerialdatabaseapp.firebaseapp.com",
  databaseURL: "https://signagematerialdatabaseapp-default-rtdb.firebaseio.com",
  projectId: "signagematerialdatabaseapp",
  storageBucket: "signagematerialdatabaseapp.firebasestorage.app",
  messagingSenderId: "276886100857",
  appId: "1:276886100857:web:ec1b93f74995aa30e1ada8",
  measurementId: "G-R4EHYT0MW6"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

auth.onAuthStateChanged(user => {
  if (!user) {
    window.location.href = "login.html";
  } else {
    document.getElementById('user-info').innerText = "Logged in as: " + user.email;
    loadMaterials();
  }
});

function logout() {
  auth.signOut();
}

function loadMaterials() {
  let materials = JSON.parse(localStorage.getItem("materials")) || [];
  const tbody = document.getElementById('material-body');
  tbody.innerHTML = "";
  materials.forEach((mat, index) => {
    tbody.innerHTML += `
    <tr>
      <td>${mat.code}</td>
      <td>${mat.name}</td>
      <td>${mat.price}</td>
      <td>${mat.unit}</td>
      <td>${mat.priceUnit}</td>
      <td>${mat.unit2}</td>
      <td><button onclick="editMaterial(${index})">Edit</button> <button onclick="deleteMaterial(${index})">Delete</button></td>
    </tr>`;
  });
}

function saveMaterial() {
  let materials = JSON.parse(localStorage.getItem("materials")) || [];
  const newMat = {
    code: document.getElementById('code').value,
    name: document.getElementById('name').value,
    price: document.getElementById('price').value,
    unit: document.getElementById('unit').value,
    priceUnit: document.getElementById('priceUnit').value,
    unit2: document.getElementById('unit2').value
  };
  materials.push(newMat);
  localStorage.setItem("materials", JSON.stringify(materials));
  loadMaterials();
}

function editMaterial(index) {
  let materials = JSON.parse(localStorage.getItem("materials")) || [];
  let mat = materials[index];
  document.getElementById('code').value = mat.code;
  document.getElementById('name').value = mat.name;
  document.getElementById('price').value = mat.price;
  document.getElementById('unit').value = mat.unit;
  document.getElementById('priceUnit').value = mat.priceUnit;
  document.getElementById('unit2').value = mat.unit2;
  materials.splice(index, 1);
  localStorage.setItem("materials", JSON.stringify(materials));
  loadMaterials();
}

function deleteMaterial(index) {
  let materials = JSON.parse(localStorage.getItem("materials")) || [];
  materials.splice(index, 1);
  localStorage.setItem("materials", JSON.stringify(materials));
  loadMaterials();
}
</script>
</body>
</html>
