<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Signage Calculator - Database</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* Global Styles */
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #fff;
    }

    .light-mode {
      background-color: #f4f4f4;
      color: #000;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      background-color: #1f1f1f;
      color: #fff;
      border-bottom: 1px solid #444;
    }

    .light-mode header {
      background-color: #fff;
      color: #000;
      border-color: #ddd;
    }

    .nav-left {
      font-size: 20px;
      font-weight: bold;
    }

    .nav-right a {
      color: inherit;
      text-decoration: none;
      margin-left: 15px;
    }

    .nav-right {
      display: flex;
      align-items: center;
    }

    .dropdown {
      position: relative;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #333;
      min-width: 100px;
      right: 0;
      z-index: 1;
    }

    .dropdown-content a {
      color: #fff;
      padding: 8px 12px;
      display: block;
    }

    .dropdown:hover .dropdown-content {
      display: block;
    }

    .light-mode .dropdown-content {
      background-color: #f4f4f4;
    }

    .toggle-btn {
      margin-left: 20px;
      cursor: pointer;
      padding: 5px 10px;
      background-color: #444;
      border: none;
      color: #fff;
    }

    .light-mode .toggle-btn {
      background-color: #ccc;
      color: #000;
    }

    .auth-info {
      font-size: 14px;
      margin-left: 20px;
    }

    /* Table Styles */
    .table-wrapper {
      margin: 20px;
      border: 1px solid #444;
      max-height: 500px;
      overflow-y: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: inherit;
    }

    thead {
      position: sticky;
      top: 0;
      background-color: #222;
    }

    .light-mode thead {
      background-color: #eee;
    }

    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #444;
    }

    tr.editing {
      background-color: #333;
    }

    .light-mode tr.editing {
      background-color: #e0e0e0;
    }

    /* Action Buttons */
    .action-btn {
      margin: 5px;
      padding: 5px 10px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
    }

    .add-btn {
      background-color: #4caf50;
      color: white;
    }

    .delete-btn {
      background-color: #f44336;
      color: white;
    }

    .save-btn {
      background-color: #2196f3;
      color: white;
    }

    .edit-btn {
      background-color: #ff9800;
      color: white;
    }

    /* Filter Section */
    .filter-section {
      margin: 20px;
    }

    .filter-section input {
      padding: 6px;
      width: 250px;
    }

    .category-heading {
      margin-top: 30px;
      font-size: 18px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header>
    <div class="nav-left">Signage Calculator</div>
    <div class="nav-right">
      <a href="index.html">Database</a>
      <a href="calculation.html">Calculation</a>
      <a href="quotation.html">Quotation</a>
      <div class="dropdown">
        <a href="#">More â–¼</a>
        <div class="dropdown-content">
          <a href="#">Coming Soon</a>
        </div>
      </div>
      <button class="toggle-btn" onclick="toggleDarkMode()">ðŸŒ™</button>
      <div class="auth-info" id="authInfo"></div>
      <button class="toggle-btn" onclick="logout()">Logout</button>
    </div>
  </header>

  <div class="filter-section">
    <input type="text" id="filterInput" placeholder="Filter materials by name..." onkeyup="filterMaterials()" />
  </div>

  <div id="materialContainer" class="table-wrapper">
    <!-- Material tables will be inserted here -->
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCXtiSnNBHs1NQXwL6vrK-U71veeMpIpXQ",
      authDomain: "signagematerialdatabaseapp.firebaseapp.com",
      databaseURL: "https://signagematerialdatabaseapp-default-rtdb.firebaseio.com",
      projectId: "signagematerialdatabaseapp",
      storageBucket: "signagematerialdatabaseapp.appspot.com",
      messagingSenderId: "276886100857",
      appId: "1:276886100857:web:ec1b93f74995aa30e1ada8",
      measurementId: "G-R4EHYT0MW6"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    const adminEmail = "youradmin@email.com";

    auth.onAuthStateChanged(user => {
      if (!user) {
        location.href = "login.html";
      } else {
        document.getElementById('authInfo').innerText = `Logged in as: ${user.email}`;
        loadMaterials(user.email === adminEmail);
      }
    });

    function logout() {
      firebase.auth().signOut().then(() => {
        location.href = "login.html";
      });
    }

    function toggleDarkMode() {
      document.body.classList.toggle('light-mode');
    }

    function loadMaterials(isAdmin) {
      db.ref("materials").once("value", snapshot => {
        const data = snapshot.val();
        const container = document.getElementById("materialContainer");
        container.innerHTML = '';

        if (!data) {
          container.innerHTML = "<p>No data available.</p>";
          return;
        }

        Object.keys(data).forEach(category => {
          const table = document.createElement("table");
          const thead = table.createTHead();
          const headerRow = thead.insertRow();
          ["Code", "Name", "Price", "Unit", "Price/Unit", "Unit 2", ...(isAdmin ? ["Actions"] : [])]
            .forEach(text => {
              const th = document.createElement("th");
              th.textContent = text;
              headerRow.appendChild(th);
            });

          const tbody = table.createTBody();
          Object.entries(data[category]).forEach(([code, mat]) => {
            const row = tbody.insertRow();
            row.innerHTML = `
              <td>${code}</td>
              <td>${mat.MaterialName}</td>
              <td>${mat.MaterialPrice}</td>
              <td>${mat.Unit}</td>
              <td>${mat.PricePerUnit}</td>
              <td>${mat.Unit2}</td>
              ${isAdmin ? `<td><button class="edit-btn action-btn">Edit</button></td>` : ""}
            `;
          });

          const heading = document.createElement("div");
          heading.className = "category-heading";
          heading.textContent = category;
          container.appendChild(heading);
          container.appendChild(table);
        });
      });
    }

    function filterMaterials() {
      const input = document.getElementById("filterInput").value.toLowerCase();
      const tables = document.querySelectorAll("table");

      tables.forEach(table => {
        const rows = table.querySelectorAll("tbody tr");
        rows.forEach(row => {
          const match = row.textContent.toLowerCase().includes(input);
          row.style.display = match ? "" : "none";
        });
      });
    }
  </script>
</body>
</html>
