<!DOCTYPE html>
<html>
<head>
  <title>Signage Calculator - Login</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; text-align: center; background: #f0f0f0; margin: 0; padding: 0; }
    .login-box { background: white; padding: 20px; margin: 100px auto; width: 300px; box-shadow: 0 0 10px #ccc; border-radius: 8px; }
    input { width: 90%; margin: 10px 0; padding: 8px; }
    button { padding: 10px 20px; margin-top: 10px; }
    .error { color: red; }
  </style>
</head>
<body>
  <div class="login-box">
    <h2>Signage Calculator</h2>
    <input type="email" id="email" placeholder="Email" /><br />
    <input type="password" id="password" placeholder="Password" /><br />
    <button onclick="login()">Log In</button>
    <p id="error" class="error"></p>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCXtiSnNBHs1NQXwL6vrK-U71veeMpIpXQ",
      authDomain: "signagematerialdatabaseapp.firebaseapp.com",
      databaseURL: "https://signagematerialdatabaseapp-default-rtdb.firebaseio.com",
      projectId: "signagematerialdatabaseapp",
      storageBucket: "signagematerialdatabaseapp.firebasestorage.app",
      messagingSenderId: "276886100857",
      appId: "1:276886100857:web:ec1b93f74995aa30e1ada8",
      measurementId: "G-R4EHYT0MW6"
    };
    firebase.initializeApp(firebaseConfig);

    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      firebase.auth().signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          const uid = userCredential.user.uid;
          firebase.database().ref("roles/" + uid).once("value", snapshot => {
            const role = snapshot.val();
            if (role === "admin" || role === "user") {
              sessionStorage.setItem("user", JSON.stringify({ uid, email, role }));
              window.location.href = "index.html";
            } else {
              document.getElementById("error").innerText = "Role not assigned.";
            }
          });
        })
        .catch(error => {
          const msg = error.code === "auth/user-not-found" ? "No user found." :
                      error.code === "auth/wrong-password" ? "Incorrect password." :
                      "Login failed.";
          document.getElementById("error").innerText = msg;
        });
    }
  </script>
</body>
</html>
